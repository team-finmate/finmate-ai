# core/config.py
from dotenv import load_dotenv
import os

# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
load_dotenv()

# OpenAI API í‚¤
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

# 1) ê·œì¹™ ì •ì˜ -----------------------------------------------------------------
WEEKEND_DAYS = {5, 6}

WEEKDAY_BUCKETS = [
    ("07:00", "09:00", "ì¶œê·¼ê¸¸_ì•„ì¹¨"),
    ("09:00", "12:00", "ì˜¤ì „_ì—…ë¬´ì‹œê°„"),
    ("12:00", "14:00", "ì ì‹¬ì‹œê°„"),
    ("14:00", "18:00", "ì˜¤í›„_ì—…ë¬´ì‹œê°„"),
    ("18:00", "21:00", "ì €ë…_í‡´ê·¼í›„"),
    ("21:00", "24:00", "ë°¤_íœ´ì‹ì‹œê°„"),
    ("00:00", "07:00", "ìƒˆë²½_ì‹¬ì•¼"),
]

WEEKEND_BUCKETS = [
    ("07:00", "10:00", "ì£¼ë§_ì•„ì¹¨"),
    ("10:00", "14:00", "ì£¼ë§_ì˜¤ì „_í™œë™"),
    ("14:00", "18:00", "ì£¼ë§_ì˜¤í›„_í™œë™"),
    ("18:00", "22:00", "ì£¼ë§_ì €ë…"),
    ("22:00", "24:00", "ì£¼ë§_ë°¤"),
    ("00:00", "07:00", "ì£¼ë§_ìƒˆë²½"),
]

# ê¸ˆì•¡ íŒ¨í„´ ë²”ìœ„(ì›)ì„ 16ê°œ ì¹´í…Œê³ ë¦¬ì— ë§ê²Œ ì¡°ì •
AMOUNT_HINTS = [
    ("ì¹´í˜/ê°„ì‹", 3000, 8000),
    ("ì‹ë¹„", 8000, 35000),  # ë°°ë‹¬ìŒì‹ í¬í•¨
    ("í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", 2000, 15000),
    ("êµí†µ/ìë™ì°¨", 1000, 50000),
    ("ì·¨ë¯¸/ì—¬ê°€", 10000, 100000),
    ("ìˆ /ìœ í¥", 20000, 200000),
    ("ì‡¼í•‘", 10000, 150000),  # ì˜¨ë¼ì¸ì‡¼í•‘ ëŒ€ì²´
    ("ì£¼ê±°/í†µì‹ ", 30000, 200000),  # êµ¬ë…ì„œë¹„ìŠ¤ í¬í•¨
    ("ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", 10000, 100000),
    ("ì—¬í–‰/ìˆ™ë°•", 50000, 500000),
    ("ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", 50000, 1000000),
    ("ì´ì²´", 10000, 5000000),
    ("ìƒí™œ", 5000, 50000),
    ("êµìœ¡", 30000, 500000),
    ("ë¯¸ìš©", 10000, 100000),
    ("ì¹´í…Œê³ ë¦¬ ì—†ìŒ", 1000, 1000000),
]

# ìƒì /ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ â†’ ë¼ë²¨ íŒíŠ¸ (16ê°œ ì¹´í…Œê³ ë¦¬ ë°˜ì˜)
KEYWORD_HINTS = {
    # ì‹ë¹„ (ë°°ë‹¬/ì™¸ì‹ í¬í•¨)
    "ë°°ë‹¬ì˜ë¯¼ì¡±": "ì‹ë¹„", "ìš”ê¸°ìš”": "ì‹ë¹„", "ë°°ë¯¼": "ì‹ë¹„",
    "ì¿ íŒ¡ì´ì¸ ": "ì‹ë¹„", "ìœ„ë©”í”„ì˜¤": "ì‹ë¹„", "ë§¥ë„ë‚ ë“œ": "ì‹ë¹„",
    "ë²„ê±°í‚¹": "ì‹ë¹„", "KFC": "ì‹ë¹„", "ë¡¯ë°ë¦¬ì•„": "ì‹ë¹„",
    "ê¹€ë°¥ì²œêµ­": "ì‹ë¹„", "ë°±ë°˜": "ì‹ë¹„", "í•œì‹": "ì‹ë¹„",
    
    # ì¹´í˜/ê°„ì‹
    "ìŠ¤íƒ€ë²…ìŠ¤": "ì¹´í˜/ê°„ì‹", "ì´ë””ì•¼": "ì¹´í˜/ê°„ì‹", "ì»¤í”¼": "ì¹´í˜/ê°„ì‹",
    "íˆ¬ì¸": "ì¹´í˜/ê°„ì‹", "ë¹½ë‹¤ë°©": "ì¹´í˜/ê°„ì‹", "ë©”ê°€ì»¤í”¼": "ì¹´í˜/ê°„ì‹",
    "ë² ì´ì»¤ë¦¬": "ì¹´í˜/ê°„ì‹", "ë„ë„›": "ì¹´í˜/ê°„ì‹", "ì•„ì´ìŠ¤í¬ë¦¼": "ì¹´í˜/ê°„ì‹",
    
    # í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”
    "í¸ì˜ì ": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "CU": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", 
    "GS25": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "ì„¸ë¸ì¼ë ˆë¸": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”",
    "ì´ë§ˆíŠ¸": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "í™ˆí”ŒëŸ¬ìŠ¤": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", 
    "ë¡¯ë°ë§ˆíŠ¸": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "ë‹¤ì´ì†Œ": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”",
    "ì˜¬ë¦¬ë¸Œì˜": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "ì™“ìŠ¨ìŠ¤": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”",
    
    # ì‡¼í•‘ (ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸)
    "ì¿ íŒ¡": "ì‡¼í•‘", "11ë²ˆê°€": "ì‡¼í•‘", "Gë§ˆì¼“": "ì‡¼í•‘",
    "ì˜¥ì…˜": "ì‡¼í•‘", "ìœ„ë©”í”„": "ì‡¼í•‘", "í‹°ëª¬": "ì‡¼í•‘",
    "ë¬´ì‹ ì‚¬": "ì‡¼í•‘", "29CM": "ì‡¼í•‘", "ë¸Œëœë””": "ì‡¼í•‘",
    "ì‹ ì„¸ê³„": "ì‡¼í•‘", "í˜„ëŒ€ë°±í™”ì ": "ì‡¼í•‘", "ë¡¯ë°ë°±í™”ì ": "ì‡¼í•‘",
    
    # ì·¨ë¯¸/ì—¬ê°€
    "CGV": "ì·¨ë¯¸/ì—¬ê°€", "ë¡¯ë°ì‹œë„¤ë§ˆ": "ì·¨ë¯¸/ì—¬ê°€", "ë©”ê°€ë°•ìŠ¤": "ì·¨ë¯¸/ì—¬ê°€",
    "PCë°©": "ì·¨ë¯¸/ì—¬ê°€", "ë…¸ë˜ë°©": "ì·¨ë¯¸/ì—¬ê°€", "ë³¼ë§": "ì·¨ë¯¸/ì—¬ê°€",
    "ë‹¹êµ¬": "ì·¨ë¯¸/ì—¬ê°€", "ê²Œì„": "ì·¨ë¯¸/ì—¬ê°€", "ì±…": "ì·¨ë¯¸/ì—¬ê°€",
    
    # ì£¼ê±°/í†µì‹  (êµ¬ë…ì„œë¹„ìŠ¤ í¬í•¨)
    "ë„·í”Œë¦­ìŠ¤": "ì£¼ê±°/í†µì‹ ", "ìœ íŠœë¸Œ": "ì£¼ê±°/í†µì‹ ", "ë””ì¦ˆë‹ˆí”ŒëŸ¬ìŠ¤": "ì£¼ê±°/í†µì‹ ",
    "ìŠ¤í¬í‹°íŒŒì´": "ì£¼ê±°/í†µì‹ ", "ë©œë¡ ": "ì£¼ê±°/í†µì‹ ", "ì›¨ì´ë¸Œ": "ì£¼ê±°/í†µì‹ ",
    "í†µì‹ ë¹„": "ì£¼ê±°/í†µì‹ ", "ì¸í„°ë„·": "ì£¼ê±°/í†µì‹ ", "ì „ê¸°ë£Œ": "ì£¼ê±°/í†µì‹ ",
    "ê°€ìŠ¤ë¹„": "ì£¼ê±°/í†µì‹ ", "ìˆ˜ë„ë£Œ": "ì£¼ê±°/í†µì‹ ", "ê´€ë¦¬ë¹„": "ì£¼ê±°/í†µì‹ ",
    "SKí…”ë ˆì½¤": "ì£¼ê±°/í†µì‹ ", "KT": "ì£¼ê±°/í†µì‹ ", "LGìœ í”ŒëŸ¬ìŠ¤": "ì£¼ê±°/í†µì‹ ",
    
    # êµí†µ/ìë™ì°¨
    "íƒì‹œ": "êµí†µ/ìë™ì°¨", "ì¹´ì¹´ì˜¤íƒì‹œ": "êµí†µ/ìë™ì°¨", "ìš°ë²„": "êµí†µ/ìë™ì°¨",
    "ì£¼ìœ ": "êµí†µ/ìë™ì°¨", "ì§€í•˜ì² ": "êµí†µ/ìë™ì°¨", "ë²„ìŠ¤": "êµí†µ/ìë™ì°¨",
    "í†¨ê²Œì´íŠ¸": "êµí†µ/ìë™ì°¨", "ì£¼ì°¨": "êµí†µ/ìë™ì°¨", "ë Œí„°ì¹´": "êµí†µ/ìë™ì°¨",
    
    # ìˆ /ìœ í¥
    "ì†Œì£¼": "ìˆ /ìœ í¥", "ë§¥ì£¼": "ìˆ /ìœ í¥", "ì™€ì¸": "ìˆ /ìœ í¥",
    "í´ëŸ½": "ìˆ /ìœ í¥", "í˜¸í”„": "ìˆ /ìœ í¥", "ë°”": "ìˆ /ìœ í¥",
    "ì¹˜í‚¨": "ìˆ /ìœ í¥", "ìˆ ì§‘": "ìˆ /ìœ í¥", "í¬ì°¨": "ìˆ /ìœ í¥",
    
    # ì—¬í–‰/ìˆ™ë°•
    "ì—¬í–‰": "ì—¬í–‰/ìˆ™ë°•", "í˜¸í…”": "ì—¬í–‰/ìˆ™ë°•", "ì—ì–´ë¹„ì•¤ë¹„": "ì—¬í–‰/ìˆ™ë°•",
    "ëª¨í…”": "ì—¬í–‰/ìˆ™ë°•", "íœì…˜": "ì—¬í–‰/ìˆ™ë°•", "ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤": "ì—¬í–‰/ìˆ™ë°•",
    "í•­ê³µ": "ì—¬í–‰/ìˆ™ë°•", "ê¸°ì°¨": "ì—¬í–‰/ìˆ™ë°•", "ê³ ì†ë²„ìŠ¤": "ì—¬í–‰/ìˆ™ë°•",
    
    # ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤
    "ë³‘ì›": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "ì•½êµ­": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "ì¹˜ê³¼": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤",
    "í”¼íŠ¸ë‹ˆìŠ¤": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "í—¬ìŠ¤ì¥": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤",
    "ìš”ê°€": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "í•„ë¼í…ŒìŠ¤": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤",
    "ë§ˆì‚¬ì§€": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "ì‚¬ìš°ë‚˜": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤",
    
    # êµìœ¡
    "í•™ì›": "êµìœ¡", "ì˜¨ë¼ì¸ê°•ì˜": "êµìœ¡", "ì±…": "êµìœ¡",
    "í•™ìš©í’ˆ": "êµìœ¡", "ê°•ì˜": "êµìœ¡", "ì„¸ë¯¸ë‚˜": "êµìœ¡",
    
    # ë¯¸ìš©
    "ë¯¸ìš©ì‹¤": "ë¯¸ìš©", "ë„¤ì¼": "ë¯¸ìš©", "í”¼ë¶€ê´€ë¦¬": "ë¯¸ìš©",
    "ì„±í˜•ì™¸ê³¼": "ë¯¸ìš©", "í™”ì¥í’ˆ": "ë¯¸ìš©", "í–¥ìˆ˜": "ë¯¸ìš©",
    
    # ìƒí™œ
    "ì„¸íƒì†Œ": "ìƒí™œ", "ì²­ì†Œ": "ìƒí™œ", "ìˆ˜ë¦¬": "ìƒí™œ",
    "íƒë°°": "ìƒí™œ", "ìš°ì²´êµ­": "ìƒí™œ", "ì€í–‰": "ìƒí™œ",
    
    # ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ
    "ë³´í—˜": "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", "ì„¸ê¸ˆ": "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", 
    "êµ­ë¯¼ì—°ê¸ˆ": "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", "ê±´ê°•ë³´í—˜": "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ",
    "ì¦ê¶Œ": "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", "íˆ¬ì": "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ",
    
    # ì´ì²´
    "ì†¡ê¸ˆ": "ì´ì²´", "ê³„ì¢Œì´ì²´": "ì´ì²´", "ì…ê¸ˆ": "ì´ì²´",
    "ì¶œê¸ˆ": "ì´ì²´", "ATM": "ì´ì²´", "í˜„ê¸ˆì¸ì¶œ": "ì´ì²´",
}

# ìœ„í—˜ íŒ¨í„´ ê°ì§€ ê¸°ì¤€
RISK_PATTERNS = {
    "ìƒˆë²½_ì†Œë¹„": ["ìƒˆë²½_ì‹¬ì•¼", "ì£¼ë§_ìƒˆë²½"],  # ìƒˆë²½ ì‹œê°„ëŒ€ ì†Œë¹„
    "ê³ ì•¡_ë‹¨ê±´": 100000,  # 10ë§Œì› ì´ìƒ ë‹¨ê±´ ê²°ì œ
    "ë°˜ë³µ_ë°°ë‹¬": {"category": "ë°°ë‹¬ìŒì‹", "threshold": 3},  # ì¼ì • ê¸°ê°„ ë‚´ ë°˜ë³µ ë°°ë‹¬
    "êµ¬ë…_ê³¼ë‹¤": {"category": "êµ¬ë…ì„œë¹„ìŠ¤", "threshold": 5},  # ë‹¤ìˆ˜ êµ¬ë… ì„œë¹„ìŠ¤
}

# ì ˆì•½ ì œì•ˆ ë ˆë²¨ë³„ êµ¬ì„± (16ê°œ ì¹´í…Œê³ ë¦¬ ë°˜ì˜)
SAVING_LEVELS = {
    "ê°•í•œì ˆì•½": {
        "name": "ğŸ”¥ ê°•í•œ ì ˆì•½",
        "description": "ê³ ì •ë¹„ë¥¼ í¬í•¨í•œ ì „ë©´ì  ì§€ì¶œ ì ˆì•½",
        "reduction_rate": 0.3,  # 30% ì ˆì•½
        "includes_fixed_costs": True,
        "priority_categories": ["ì£¼ê±°/í†µì‹ ", "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", "ì‹ë¹„", "ì‡¼í•‘", "ì·¨ë¯¸/ì—¬ê°€"]
    },
    "ë³´í†µì ˆì•½": {
        "name": "ğŸ’ª ë³´í†µ ì ˆì•½", 
        "description": "ì£¼ìš” ì§€ì¶œ ì¹´í…Œê³ ë¦¬ ì¤‘ì‹¬ ì ˆì•½",
        "reduction_rate": 0.2,  # 20% ì ˆì•½
        "includes_fixed_costs": False,
        "priority_categories": ["ì‹ë¹„", "ì¹´í˜/ê°„ì‹", "ì‡¼í•‘", "êµí†µ/ìë™ì°¨", "ì·¨ë¯¸/ì—¬ê°€"]
    },
    "ì•½í•œì ˆì•½": {
        "name": "ğŸŒ± ì•½í•œ ì ˆì•½",
        "description": "ë¹ˆë²ˆí•˜ê³  ë¶ˆí•„ìš”í•œ ì†Œë¹„ ì ì§„ì  ì ˆì•½",
        "reduction_rate": 0.1,  # 10% ì ˆì•½
        "includes_fixed_costs": False,
        "priority_categories": ["ì¹´í˜/ê°„ì‹", "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "ìˆ /ìœ í¥", "ìƒí™œ"]
    }
}

# ì¹´í…Œê³ ë¦¬ë³„ ì ˆì•½ ì „ëµ í…œí”Œë¦¿ (16ê°œ ì¹´í…Œê³ ë¦¬)
SAVING_STRATEGIES = {
    # ê³ ì •ë¹„ ê´€ë ¨
    "ì£¼ê±°/í†µì‹ ": {
        "ê°•í•œì ˆì•½": "í†µì‹ ìš”ê¸ˆì œ ì¬ê²€í†  + êµ¬ë…ì„œë¹„ìŠ¤ ì •ë¦¬ + ë¶ˆí•„ìš”í•œ ì˜µì…˜ í•´ì§€ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "í†µì‹ ìš”ê¸ˆì œ ë‹¤ìš´ê·¸ë ˆì´ë“œ + ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” êµ¬ë… í•´ì§€ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¶€ê°€ì„œë¹„ìŠ¤ í•´ì§€ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ": {
        "ê°•í•œì ˆì•½": "ë³´í—˜ ìƒí’ˆ ì¬ê²€í†  + ë¶ˆí•„ìš”í•œ ê¸ˆìœµìƒí’ˆ ì •ë¦¬ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ë³´í—˜ë£Œ í• ì¸ í˜œíƒ ì ìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ê¸ˆìœµ ìˆ˜ìˆ˜ë£Œ ìµœì†Œí™”ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    
    # ë³€ë™ë¹„ ê´€ë ¨ - ì£¼ìš” ì§€ì¶œ
    "ì‹ë¹„": {
        "ê°•í•œì ˆì•½": "ì™¸ì‹/ë°°ë‹¬ì„ ì£¼ {current_count}íšŒì—ì„œ {target_count}íšŒë¡œ ì¤„ì´ê³  ì§ì ‘ ìš”ë¦¬ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì™¸ì‹/ë°°ë‹¬ ì£¼ë¬¸ì„ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ë°°ë‹¬ìŒì‹ ëŒ€ì‹  ê°„í¸ì‹ ì´ìš©ìœ¼ë¡œ ì£¼ 1íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì¹´í˜/ê°„ì‹": {
        "ê°•í•œì ˆì•½": "ì¹´í˜ ì´ìš©ì„ í•˜ë£¨ {current_count}íšŒì—ì„œ {target_count}íšŒë¡œ ì¤„ì´ê³  í™ˆì¹´í˜ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì¹´í˜ ë°©ë¬¸ì„ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ê°„ì‹ êµ¬ë§¤ë¥¼ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì‡¼í•‘": {
        "ê°•í•œì ˆì•½": "ì¶©ë™êµ¬ë§¤ ê¸ˆì§€ + í•„ìˆ˜í’ˆëª©ë§Œ êµ¬ë§¤ ë¦¬ìŠ¤íŠ¸ ì‘ì„±ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì‡¼í•‘ ë¹ˆë„ë¥¼ ì›” {current_count}íšŒì—ì„œ {target_count}íšŒë¡œ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ì¿ í° ì ê·¹ í™œìš© + í• ì¸ ì‹œê¸° êµ¬ë§¤ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "êµí†µ/ìë™ì°¨": {
        "ê°•í•œì ˆì•½": "íƒì‹œ ì´ìš©ì„ ëŒ€ì¤‘êµí†µìœ¼ë¡œ ì™„ì „ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "íƒì‹œ ì´ìš©ì„ ì£¼ {reduce_count}íšŒ ì¤„ì´ê³  ëŒ€ì¤‘êµí†µ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ê°€ê¹Œìš´ ê±°ë¦¬ëŠ” ë„ë³´/ìì „ê±° ì´ìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì·¨ë¯¸/ì—¬ê°€": {
        "ê°•í•œì ˆì•½": "ìœ ë£Œ ì—¬ê°€í™œë™ì„ ë¬´ë£Œ/ì €ë ´í•œ ëŒ€ì•ˆìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì—¬ê°€ ì§€ì¶œì„ ì›” {budget:,}ì› ì˜ˆì‚°ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "í• ì¸ í˜œíƒ ì ê·¹ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    
    # ë³€ë™ë¹„ ê´€ë ¨ - ì†Œì•¡ ì§€ì¶œ
    "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”": {
        "ê°•í•œì ˆì•½": "í¸ì˜ì  ì´ìš©ì„ ë§ˆíŠ¸ ëŒ€ëŸ‰êµ¬ë§¤ë¡œ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "í¸ì˜ì  ë°©ë¬¸ì„ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "í•„ìš”í•œ ê²ƒë§Œ êµ¬ë§¤ ë¦¬ìŠ¤íŠ¸ ì‘ì„±ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ìˆ /ìœ í¥": {
        "ê°•í•œì ˆì•½": "ìœ í¥ë¹„ë¥¼ ì›” {budget:,}ì› ì˜ˆì‚°ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ìˆ ìë¦¬ ë¹ˆë„ë¥¼ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ì§‘ì—ì„œ ê°„ë‹¨íˆ ë§ˆì‹œê¸°ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ìƒí™œ": {
        "ê°•í•œì ˆì•½": "ìƒí™œ ì„œë¹„ìŠ¤ë¥¼ ì§ì ‘ ì²˜ë¦¬í•˜ê±°ë‚˜ ì €ë ´í•œ ëŒ€ì•ˆìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ìƒí™œë¹„ ì§€ì¶œì„ ì›” {budget:,}ì› ì˜ˆì‚°ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "í• ì¸ ì„œë¹„ìŠ¤ ì ê·¹ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    
    # ê¸°íƒ€ ì¹´í…Œê³ ë¦¬
    "ì—¬í–‰/ìˆ™ë°•": {
        "ê°•í•œì ˆì•½": "ì—¬í–‰ íšŸìˆ˜ë¥¼ ì¤„ì´ê³  êµ­ë‚´ ì—¬í–‰ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì—¬í–‰ ì˜ˆì‚°ì„ ì›” {budget:,}ì›ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ì—¬í–‰ ì˜ˆì•½ ì‹œ í• ì¸ í˜œíƒ ì ê·¹ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤": {
        "ê°•í•œì ˆì•½": "í—¬ìŠ¤ì¥ì„ í™ˆíŠ¸ë ˆì´ë‹ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ê±´ê°• ê´€ë¦¬ ì˜ˆì‚°ì„ ì›” {budget:,}ì›ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ê±´ê°•ë³´í—˜ í• ì¸ í˜œíƒ ì ê·¹ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "êµìœ¡": {
        "ê°•í•œì ˆì•½": "ì˜¨ë¼ì¸ ê°•ì˜ë¡œ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "êµìœ¡ ì˜ˆì‚°ì„ ì›” {budget:,}ì›ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ë¬´ë£Œ êµìœ¡ ìë£Œ ì ê·¹ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ë¯¸ìš©": {
        "ê°•í•œì ˆì•½": "ë¯¸ìš©ì‹¤ ë°©ë¬¸ íšŸìˆ˜ë¥¼ ì¤„ì´ê³  ì…€í”„ì¼€ì–´ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ë¯¸ìš© ì˜ˆì‚°ì„ ì›” {budget:,}ì›ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ë¯¸ìš© í• ì¸ í˜œíƒ ì ê·¹ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    }
}

# ì ˆì•½ ê³„ì‚° ê¸°ì¤€ (16ê°œ ì¹´í…Œê³ ë¦¬ ë°˜ì˜)
SAVING_CALCULATION_RULES = {
    "ê°•í•œì ˆì•½": {
        "min_target_reduction": 0.25,  # ìµœì†Œ 25% ì ˆì•½
        "max_target_reduction": 0.4,   # ìµœëŒ€ 40% ì ˆì•½
        "include_categories": ["ëª¨ë“ ì¹´í…Œê³ ë¦¬"],
        "strategy_focus": "êµ¬ì¡°ì  ë³€í™”"
    },
    "ë³´í†µì ˆì•½": {
        "min_target_reduction": 0.15,  # ìµœì†Œ 15% ì ˆì•½
        "max_target_reduction": 0.25,  # ìµœëŒ€ 25% ì ˆì•½
        "exclude_categories": ["ì£¼ê±°/í†µì‹ ", "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "êµìœ¡", "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", "ì´ì²´"],
        "strategy_focus": "ìŠµê´€ ê°œì„ "
    },
    "ì•½í•œì ˆì•½": {
        "min_target_reduction": 0.05,  # ìµœì†Œ 5% ì ˆì•½
        "max_target_reduction": 0.15,  # ìµœëŒ€ 15% ì ˆì•½
        "exclude_categories": ["ì£¼ê±°/í†µì‹ ", "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "êµìœ¡", "êµí†µ/ìë™ì°¨", "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ", "ì´ì²´"],
        "strategy_focus": "ì ì§„ì  ë³€í™”"
    }
}

# OpenAI ëª¨ë¸ ì‹œìŠ¤í…œ ì§€ì‹œë¬¸ (16ê°œ ì¹´í…Œê³ ë¦¬ ë°˜ì˜)
SYSTEM_INSTRUCTIONS = """
ë„ˆëŠ” ê°œì¸ì˜ ê²°ì œë‚´ì—­ì„ ë¶„ì„í•˜ì—¬ ì¢…í•©ì ì¸ ì†Œë¹„ íŒ¨í„´ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ê¸ˆìœµ ë¶„ì„ê°€ë‹¤.

[ë¶„ì„ ëŒ€ìƒ ì¹´í…Œê³ ë¦¬ (16ê°œ)]
1. ì‡¼í•‘ 2. ì‹ë¹„ 3. ì—¬í–‰/ìˆ™ë°• 4. ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ 5. ì¹´í˜/ê°„ì‹ 6. ì·¨ë¯¸/ì—¬ê°€ 
7. ì´ì²´ 8. êµí†µ/ìë™ì°¨ 9. ìˆ /ìœ í¥ 10. ìƒí™œ 11. ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤ 
12. í¸ì˜ì /ë§ˆíŠ¸/ì¡í™” 13. ì£¼ê±°/í†µì‹  14. êµìœ¡ 15. ë¯¸ìš© 16. ì¹´í…Œê³ ë¦¬ ì—†ìŒ

[ë¶„ì„ ìš”êµ¬ì‚¬í•­]
1) ì „ì²´ ì§€ì¶œ ì§‘ê³„ ë° 16ê°œ ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„
2) ì†Œë¹„ íŒ¨í„´ê³¼ íŠ¸ë Œë“œ ë¶„ì„ (ì‹œê°„ëŒ€, ìš”ì¼ë³„ íŠ¹ì„± ê³ ë ¤)
3) ìœ„í—˜ íŒ¨í„´ ë° ê³¼ì†Œë¹„ ì˜ì—­ ì‹ë³„
4) 3ë‹¨ê³„ ë ˆë²¨ë³„ ë§ì¶¤ ì ˆì•½ ì œì•ˆ

[ì¶œë ¥ í˜•ì‹(JSONë§Œ)]
{
  "total_spent": 0,
  "category_breakdown": {
    "ì¹´í…Œê³ ë¦¬ëª…": {"amount": 0, "ratio": 0.0, "transaction_count": 0, "avg_amount": 0}
  },
  "spending_trend": "ìƒìŠ¹|í•˜ë½|ì•ˆì •",
  "avg_transaction": 0,
  "top_expenses": [
    {"merchant": "ìƒì ëª…", "amount": 0, "category": "ì¹´í…Œê³ ë¦¬"}
  ],
  "spending_type": "ì†Œë¹„ íŒ¨í„´ ìš”ì•½ (ì˜ˆ: ì™¸ì‹Â·ë°°ë‹¬ ì¤‘ì‹¬, ì£¼ë§ ì§€ì¶œ ì§‘ì¤‘)",
  "risk_patterns": ["ìœ„í—˜ íŒ¨í„´ ëª©ë¡"],
  "overspending_categories": ["ê³¼ì†Œë¹„ ì¹´í…Œê³ ë¦¬ ëª©ë¡"],
  "saving_suggestions": {
    "ê°•í•œì ˆì•½": {
      "level": "ğŸ”¥ ê°•í•œ ì ˆì•½",
      "description": "ê³ ì •ë¹„ë¥¼ í¬í•¨í•œ ì „ë©´ì  ì§€ì¶œ ì ˆì•½",
      "expected_saving": 0,
      "reduction_rate": "25-40%",
      "strategies": [
        {
          "category": "ì¹´í…Œê³ ë¦¬ëª…",
          "current_amount": 0,
          "target_amount": 0,
          "saving_amount": 0,
          "method": "êµ¬ì²´ì ì¸ ì ˆì•½ ë°©ë²•",
          "difficulty": "ìƒ|ì¤‘|í•˜"
        }
      ]
    },
    "ë³´í†µì ˆì•½": {
      "level": "ğŸ’ª ë³´í†µ ì ˆì•½",
      "description": "ì£¼ìš” ì§€ì¶œ ì¹´í…Œê³ ë¦¬ ì¤‘ì‹¬ ì ˆì•½",
      "expected_saving": 0,
      "reduction_rate": "15-25%",
      "strategies": [
        {
          "category": "ì¹´í…Œê³ ë¦¬ëª…",
          "current_amount": 0,
          "target_amount": 0,
          "saving_amount": 0,
          "method": "êµ¬ì²´ì ì¸ ì ˆì•½ ë°©ë²•",
          "difficulty": "ìƒ|ì¤‘|í•˜"
        }
      ]
    },
    "ì•½í•œì ˆì•½": {
      "level": "ğŸŒ± ì•½í•œ ì ˆì•½",
      "description": "ë¹ˆë²ˆí•˜ê³  ë¶ˆí•„ìš”í•œ ì†Œë¹„ ì ì§„ì  ì ˆì•½",
      "expected_saving": 0,
      "reduction_rate": "5-15%",
      "strategies": [
        {
          "category": "ì¹´í…Œê³ ë¦¬ëª…",
          "current_amount": 0,
          "target_amount": 0,
          "saving_amount": 0,
          "method": "êµ¬ì²´ì ì¸ ì ˆì•½ ë°©ë²•",
          "difficulty": "ìƒ|ì¤‘|í•˜"
        }
      ]
    }
  }
}

[ì ˆì•½ ì œì•ˆ ê°€ì´ë“œë¼ì¸]
ê°•í•œì ˆì•½ (25-40% ì ˆì•½):
- ê³ ì •ë¹„(ì£¼ê±°/í†µì‹ , ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ) í¬í•¨ ì „ë©´ì  ì ˆì•½
- êµ¬ì¡°ì  ë³€í™” ìš”êµ¬ (ìš”ê¸ˆì œ ë³€ê²½, êµ¬ë… í•´ì§€, ìƒí™œíŒ¨í„´ ë³€ê²½ ë“±)
- ë†’ì€ ì ˆì•½ íš¨ê³¼, ë†’ì€ ì‹¤í–‰ ë‚œì´ë„

ë³´í†µì ˆì•½ (15-25% ì ˆì•½):
- ì£¼ìš” ë³€ë™ë¹„ ì¹´í…Œê³ ë¦¬(ì‹ë¹„, ì‡¼í•‘, ì¹´í˜/ê°„ì‹) ì¤‘ì‹¬ ì ˆì•½
- ìŠµê´€ ê°œì„  ì¤‘ì‹¬ (ë¹ˆë„ ì¤„ì´ê¸°, ëŒ€ì•ˆ ì°¾ê¸° ë“±)
- ì¤‘ê°„ ì ˆì•½ íš¨ê³¼, ì¤‘ê°„ ì‹¤í–‰ ë‚œì´ë„

ì•½í•œì ˆì•½ (5-15% ì ˆì•½):
- ë¹ˆë²ˆí•˜ê³  ì†Œì•¡ì¸ ë¶ˆí•„ìš” ì†Œë¹„(ì¹´í˜/ê°„ì‹, í¸ì˜ì , ìƒí™œ) ì¤‘ì‹¬
- ì ì§„ì  ë³€í™” (í• ì¸ í™œìš©, ì¼ë¶€ ì¤„ì´ê¸° ë“±)
- ë‚®ì€ ì ˆì•½ íš¨ê³¼, ë‚®ì€ ì‹¤í–‰ ë‚œì´ë„

[ì¹´í…Œê³ ë¦¬ë³„ ì ˆì•½ ìš°ì„ ìˆœìœ„]
ë†’ìŒ: ì‹ë¹„, ì‡¼í•‘, ì¹´í˜/ê°„ì‹, ì·¨ë¯¸/ì—¬ê°€, ìˆ /ìœ í¥
ì¤‘ê°„: í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”, ì£¼ê±°/í†µì‹ , êµí†µ/ìë™ì°¨, ìƒí™œ, ë¯¸ìš©
ë‚®ìŒ: ì—¬í–‰/ìˆ™ë°•, ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤, êµìœ¡, ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ
ì œì™¸: ì´ì²´, ì¹´í…Œê³ ë¦¬ ì—†ìŒ

[ë¶„ì„ ê¸°ì¤€]
- category_breakdown: 'keyword_hints'ì™€ 'amount_hints'ë¥¼ ì¢…í•©í•˜ì—¬ 16ê°œ ì¹´í…Œê³ ë¦¬ë³„ ê¸ˆì•¡ê³¼ ë¹„ìœ¨ ê³„ì‚°
- spending_type: 'weekday_type', 'time_bucket' ì •ë³´ë¥¼ í™œìš©í•œ ì†Œë¹„ íŠ¹ì„± ìš”ì•½
- risk_patterns: ìƒˆë²½ ì‹œê°„ëŒ€ ì†Œë¹„, ê³ ì•¡ ê²°ì œ, ë°˜ë³µì  ì†Œë¹„ íŒ¨í„´ ë“± ì‹ë³„
- overspending_categories: í‰ê·  ëŒ€ë¹„ ê³¼ë„í•œ ì§€ì¶œ ì¹´í…Œê³ ë¦¬
- saving_suggestions: ê° ë ˆë²¨ë³„ë¡œ ì‹¤ì œ ê¸ˆì•¡ê³¼ êµ¬ì²´ì ì¸ ë°©ë²•ì„ í¬í•¨í•œ ë§ì¶¤ ì ˆì•½ ì „ëµ

[ì£¼ì˜ì‚¬í•­]
- ë°˜ë“œì‹œ ìœ íš¨í•œ JSONë§Œ ì¶œë ¥
- 16ê°œ ì¹´í…Œê³ ë¦¬ ì¤‘ í•´ë‹¹í•˜ëŠ” ì¹´í…Œê³ ë¦¬ë§Œ ë¶„ì„
- ê¸ˆì•¡ì€ ì •ìˆ˜ë¡œ ë°˜ì˜¬ë¦¼
- ë¹„ìœ¨ì€ ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€
- ê° ì ˆì•½ ë ˆë²¨ë³„ë¡œ í˜„ì‹¤ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì•ˆ ì‘ì„±
- ì ˆì•½ ê¸ˆì•¡ ê³„ì‚° ì‹œ í˜„ì¬ ì§€ì¶œ íŒ¨í„´ê³¼ ë¹ˆë„ë¥¼ ê³ ë ¤
- ë°ì´í„°ê°€ ë¶€ì¡±í•œ ê²½ìš° ë³´ìˆ˜ì ìœ¼ë¡œ ë¶„ì„
- ì´ì²´, ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµì€ ì ˆì•½ ì œì•ˆì—ì„œ ì œì™¸
"""

# ì ˆì•½ ì œì•ˆ ê³„ì‚° í—¬í¼ í•¨ìˆ˜ë“¤
def calculate_saving_amount(category, current_amount, level, transaction_count=1):
    """
    ì¹´í…Œê³ ë¦¬ë³„ ì ˆì•½ ê¸ˆì•¡ ê³„ì‚°
    """
    rules = SAVING_CALCULATION_RULES[level]
    
    # ê¸°ë³¸ ì ˆì•½ë¥  ì ìš©
    base_reduction = rules["min_target_reduction"]
    max_reduction = rules["max_target_reduction"]
    
    # ì¹´í…Œê³ ë¦¬ë³„ ê°€ì¤‘ì¹˜ ì ìš©
    if category in ["êµ¬ë…ì„œë¹„ìŠ¤", "ì£¼ê±°/í†µì‹ "] and level == "ê°•í•œì ˆì•½":
        reduction_rate = max_reduction  # ê³ ì •ë¹„ëŠ” ê°•í•œì ˆì•½ì—ì„œ ìµœëŒ€ ì ˆì•½
    elif category in ["ë°°ë‹¬ìŒì‹", "ì¹´í˜/ê°„ì‹"] and transaction_count > 10:
        reduction_rate = (base_reduction + max_reduction) / 2  # ë¹ˆë²ˆí•œ ì†Œë¹„ëŠ” ì¤‘ê°„ ì ˆì•½ë¥ 
    else:
        reduction_rate = base_reduction
    
    return int(current_amount * reduction_rate)

def get_difficulty_level(category, level, current_amount):
    """
    ì ˆì•½ ë‚œì´ë„ ê³„ì‚°
    """
    # ê³ ì •ë¹„ëŠ” êµ¬ì¡°ì  ë³€ê²½ì´ í•„ìš”í•˜ë¯€ë¡œ ë‚œì´ë„ ë†’ìŒ
    if category in ["êµ¬ë…ì„œë¹„ìŠ¤", "ì£¼ê±°/í†µì‹ "]:
        if level == "ê°•í•œì ˆì•½":
            return "ìƒ"
        else:
            return "ì¤‘"
    
    # ë†’ì€ ê¸ˆì•¡ ì¹´í…Œê³ ë¦¬ëŠ” ì ˆì•½ ë‚œì´ë„ ë†’ìŒ
    if current_amount > 100000:
        return "ìƒ" if level == "ê°•í•œì ˆì•½" else "ì¤‘"
    
    # ì¼ë°˜ì ì¸ ê²½ìš°
    difficulty_map = {
        "ê°•í•œì ˆì•½": "ì¤‘",
        "ë³´í†µì ˆì•½": "ì¤‘", 
        "ì•½í•œì ˆì•½": "í•˜"
    }
    return difficulty_map[level]

def generate_saving_method(category, level, current_amount, transaction_count):
    """
    ì¹´í…Œê³ ë¦¬ì™€ ë ˆë²¨ì— ë§ëŠ” ì ˆì•½ ë°©ë²• ìƒì„±
    """
    if category not in SAVING_STRATEGIES:
        return f"{level} ìˆ˜ì¤€ì—ì„œ {category} ì§€ì¶œì„ ì¤„ì—¬ ì ˆì•½í•˜ì„¸ìš”"
    
    strategy_template = SAVING_STRATEGIES[category][level]
    
    # í…œí”Œë¦¿ì— í•„ìš”í•œ ê°’ë“¤ ê³„ì‚°
    values = {}
    
    # ì ˆì•½ ê¸ˆì•¡ ê³„ì‚°
    saving_amount = calculate_saving_amount(category, current_amount, level, transaction_count)
    values["amount"] = saving_amount
    
    if "{current_count}" in strategy_template:
        values["current_count"] = max(1, transaction_count // 4)  # ì£¼ê°„ í‰ê· 
    
    if "{target_count}" in strategy_template:
        reduction_rate = SAVING_CALCULATION_RULES[level]["min_target_reduction"]
        values["target_count"] = max(1, int(values.get("current_count", 1) * (1 - reduction_rate)))
    
    if "{reduce_count}" in strategy_template:
        values["reduce_count"] = max(1, values.get("current_count", 1) - values.get("target_count", 1))
    
    if "{unused_count}" in strategy_template:
        values["unused_count"] = min(3, max(1, transaction_count // 10))
    
    if "{downgrade_count}" in strategy_template:
        values["downgrade_count"] = min(2, max(1, transaction_count // 15))
    
    if "{budget}" in strategy_template:
        values["budget"] = int(current_amount * 0.7)  # 30% ì˜ˆì‚° ê°ì¶•
    
    try:
        return strategy_template.format(**values)
    except KeyError as e:
        # ëˆ„ë½ëœ í‚¤ê°€ ìˆëŠ” ê²½ìš° ê¸°ë³¸ ë©”ì‹œì§€ ë°˜í™˜
        return f"{category}ì—ì„œ ì›” {saving_amount:,}ì› ì ˆì•½ ê°€ëŠ¥"

# ì¹´í…Œê³ ë¦¬ë³„ ìš°ì„ ìˆœìœ„ ì ìˆ˜ (ë†’ì„ìˆ˜ë¡ ì ˆì•½ íš¨ê³¼ í¼) - 16ê°œ ì¹´í…Œê³ ë¦¬
CATEGORY_PRIORITY_SCORES = {
    "ì‹ë¹„": 10,                    # ê°€ì¥ ë†’ì€ ì ˆì•½ íš¨ê³¼
    "ì‡¼í•‘": 9,
    "ì¹´í˜/ê°„ì‹": 8,
    "ì·¨ë¯¸/ì—¬ê°€": 8,
    "ìˆ /ìœ í¥": 7,
    "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”": 6,
    "ì£¼ê±°/í†µì‹ ": 5,               # ê³ ì •ë¹„ì´ì§€ë§Œ ì ˆì•½ ê°€ëŠ¥
    "êµí†µ/ìë™ì°¨": 5,
    "ìƒí™œ": 4,
    "ë¯¸ìš©": 4,
    "ì—¬í–‰/ìˆ™ë°•": 3,
    "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤": 2,      # í•„ìˆ˜ì ì´ì§€ë§Œ ì¼ë¶€ ì ˆì•½ ê°€ëŠ¥
    "êµìœ¡": 2,
    "ë³´í—˜/ì„¸ê¸ˆ/ê¸°íƒ€ê¸ˆìœµ": 1,      # í•„ìˆ˜ ê³ ì •ë¹„
    "ì´ì²´": 0,                    # ì ˆì•½ ëŒ€ìƒ ì•„ë‹˜
    "ì¹´í…Œê³ ë¦¬ ì—†ìŒ": 0            # ë¶„ë¥˜ë˜ì§€ ì•Šì€ í•­ëª©
}
