# core/config.py
from dotenv import load_dotenv
import os

# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
load_dotenv()

# OpenAI API í‚¤
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

# 1) ê·œì¹™ ì •ì˜ -----------------------------------------------------------------
WEEKEND_DAYS = {5, 6}

WEEKDAY_BUCKETS = [
    ("07:00", "09:00", "ì¶œê·¼ê¸¸_ì•„ì¹¨"),
    ("09:00", "12:00", "ì˜¤ì „_ì—…ë¬´ì‹œê°„"),
    ("12:00", "14:00", "ì ì‹¬ì‹œê°„"),
    ("14:00", "18:00", "ì˜¤í›„_ì—…ë¬´ì‹œê°„"),
    ("18:00", "21:00", "ì €ë…_í‡´ê·¼í›„"),
    ("21:00", "24:00", "ë°¤_íœ´ì‹ì‹œê°„"),
    ("00:00", "07:00", "ìƒˆë²½_ì‹¬ì•¼"),
]

WEEKEND_BUCKETS = [
    ("07:00", "10:00", "ì£¼ë§_ì•„ì¹¨"),
    ("10:00", "14:00", "ì£¼ë§_ì˜¤ì „_í™œë™"),
    ("14:00", "18:00", "ì£¼ë§_ì˜¤í›„_í™œë™"),
    ("18:00", "22:00", "ì£¼ë§_ì €ë…"),
    ("22:00", "24:00", "ì£¼ë§_ë°¤"),
    ("00:00", "07:00", "ì£¼ë§_ìƒˆë²½"),
]

# ê¸ˆì•¡ íŒ¨í„´ ë²”ìœ„(ì›)ì„ ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ì— ë§ê²Œ ì¡°ì •
AMOUNT_HINTS = [
    ("ì¹´í˜/ê°„ì‹", 3000, 8000),
    ("ì‹ë¹„", 8000, 20000),
    ("ë°°ë‹¬ìŒì‹", 15000, 35000),
    ("í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", 2000, 15000),
    ("êµí†µ/ìë™ì°¨", 1000, 50000),
    ("ì·¨ë¯¸/ì—¬ê°€", 10000, 100000),
    ("ìˆ /ìœ í¥", 20000, 200000),
    ("ì˜¨ë¼ì¸ì‡¼í•‘", 10000, 150000),
    ("êµ¬ë…ì„œë¹„ìŠ¤", 5000, 50000),
    ("ì˜ë£Œ/ê±´ê°•", 10000, 100000),
]

# ìƒì /ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ â†’ ë¼ë²¨ íŒíŠ¸ (ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ íƒœê·¸ ë°˜ì˜)
KEYWORD_HINTS = {
    # ë°°ë‹¬/ì™¸ì‹
    "ë°°ë‹¬ì˜ë¯¼ì¡±": "ë°°ë‹¬ìŒì‹", "ìš”ê¸°ìš”": "ë°°ë‹¬ìŒì‹", "ë°°ë¯¼": "ë°°ë‹¬ìŒì‹",
    "ì¿ íŒ¡ì´ì¸ ": "ë°°ë‹¬ìŒì‹", "ìœ„ë©”í”„ì˜¤": "ë°°ë‹¬ìŒì‹",
    
    # ì¹´í˜/ê°„ì‹
    "ìŠ¤íƒ€ë²…ìŠ¤": "ì¹´í˜/ê°„ì‹", "ì´ë””ì•¼": "ì¹´í˜/ê°„ì‹", "ì»¤í”¼": "ì¹´í˜/ê°„ì‹",
    "íˆ¬ì¸": "ì¹´í˜/ê°„ì‹", "ë¹½ë‹¤ë°©": "ì¹´í˜/ê°„ì‹", "ë©”ê°€ì»¤í”¼": "ì¹´í˜/ê°„ì‹",
    
    # í¸ì˜ì /ë§ˆíŠ¸
    "í¸ì˜ì ": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "CU": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", 
    "GS25": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "ì„¸ë¸ì¼ë ˆë¸": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”",
    "ì´ë§ˆíŠ¸": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "í™ˆí”ŒëŸ¬ìŠ¤": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", 
    "ë¡¯ë°ë§ˆíŠ¸": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "ë‹¤ì´ì†Œ": "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”",
    
    # ì˜¨ë¼ì¸ì‡¼í•‘
    "ì¿ íŒ¡": "ì˜¨ë¼ì¸ì‡¼í•‘", "11ë²ˆê°€": "ì˜¨ë¼ì¸ì‡¼í•‘", "Gë§ˆì¼“": "ì˜¨ë¼ì¸ì‡¼í•‘",
    "ì˜¥ì…˜": "ì˜¨ë¼ì¸ì‡¼í•‘", "ìœ„ë©”í”„": "ì˜¨ë¼ì¸ì‡¼í•‘", "í‹°ëª¬": "ì˜¨ë¼ì¸ì‡¼í•‘",
    
    # ì—”í„°í…Œì¸ë¨¼íŠ¸/ì—¬ê°€
    "CGV": "ì·¨ë¯¸/ì—¬ê°€", "ë¡¯ë°ì‹œë„¤ë§ˆ": "ì·¨ë¯¸/ì—¬ê°€", "ë©”ê°€ë°•ìŠ¤": "ì·¨ë¯¸/ì—¬ê°€",
    "ë„·í”Œë¦­ìŠ¤": "êµ¬ë…ì„œë¹„ìŠ¤", "ìœ íŠœë¸Œ": "êµ¬ë…ì„œë¹„ìŠ¤", "ë””ì¦ˆë‹ˆí”ŒëŸ¬ìŠ¤": "êµ¬ë…ì„œë¹„ìŠ¤",
    "ìŠ¤í¬í‹°íŒŒì´": "êµ¬ë…ì„œë¹„ìŠ¤", "ë©œë¡ ": "êµ¬ë…ì„œë¹„ìŠ¤",
    
    # êµí†µ
    "íƒì‹œ": "êµí†µ/ìë™ì°¨", "ì¹´ì¹´ì˜¤íƒì‹œ": "êµí†µ/ìë™ì°¨", "ìš°ë²„": "êµí†µ/ìë™ì°¨",
    "ì£¼ìœ ": "êµí†µ/ìë™ì°¨", "ì§€í•˜ì² ": "êµí†µ", "ë²„ìŠ¤": "êµí†µ",
    
    # ê¸°íƒ€
    "ì—¬í–‰": "ì—¬í–‰/ìˆ™ë°•", "í˜¸í…”": "ì—¬í–‰/ìˆ™ë°•", "ì—ì–´ë¹„ì•¤ë¹„": "ì—¬í–‰/ìˆ™ë°•",
    "í”¼íŠ¸ë‹ˆìŠ¤": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤", "í—¬ìŠ¤ì¥": "ì˜ë£Œ/ê±´ê°•/í”¼íŠ¸ë‹ˆìŠ¤",
    "ë³‘ì›": "ì˜ë£Œ/ê±´ê°•", "ì•½êµ­": "ì˜ë£Œ/ê±´ê°•", "ì¹˜ê³¼": "ì˜ë£Œ/ê±´ê°•",
    "í†µì‹ ë¹„": "ì£¼ê±°/í†µì‹ ", "ì¸í„°ë„·": "ì£¼ê±°/í†µì‹ ", "ì „ê¸°ë£Œ": "ì£¼ê±°/í†µì‹ ",
    "í•™ì›": "êµìœ¡", "ì˜¨ë¼ì¸ê°•ì˜": "êµìœ¡",
    "ë¯¸ìš©ì‹¤": "ë¯¸ìš©", "ë„¤ì¼": "ë¯¸ìš©", "ë§ˆì‚¬ì§€": "ë¯¸ìš©",
}

# ìœ„í—˜ íŒ¨í„´ ê°ì§€ ê¸°ì¤€
RISK_PATTERNS = {
    "ìƒˆë²½_ì†Œë¹„": ["ìƒˆë²½_ì‹¬ì•¼", "ì£¼ë§_ìƒˆë²½"],  # ìƒˆë²½ ì‹œê°„ëŒ€ ì†Œë¹„
    "ê³ ì•¡_ë‹¨ê±´": 100000,  # 10ë§Œì› ì´ìƒ ë‹¨ê±´ ê²°ì œ
    "ë°˜ë³µ_ë°°ë‹¬": {"category": "ë°°ë‹¬ìŒì‹", "threshold": 3},  # ì¼ì • ê¸°ê°„ ë‚´ ë°˜ë³µ ë°°ë‹¬
    "êµ¬ë…_ê³¼ë‹¤": {"category": "êµ¬ë…ì„œë¹„ìŠ¤", "threshold": 5},  # ë‹¤ìˆ˜ êµ¬ë… ì„œë¹„ìŠ¤
}

# ì ˆì•½ ì œì•ˆ ë ˆë²¨ë³„ êµ¬ì„±
SAVING_LEVELS = {
    "ê°•í•œì ˆì•½": {
        "name": "ğŸ”¥ ê°•í•œ ì ˆì•½",
        "description": "ê³ ì •ë¹„ë¥¼ í¬í•¨í•œ ì „ë©´ì  ì§€ì¶œ ì ˆì•½",
        "reduction_rate": 0.3,  # 30% ì ˆì•½
        "includes_fixed_costs": True,
        "priority_categories": ["êµ¬ë…ì„œë¹„ìŠ¤", "ì£¼ê±°/í†µì‹ ", "ë°°ë‹¬ìŒì‹", "ì˜¨ë¼ì¸ì‡¼í•‘", "ì·¨ë¯¸/ì—¬ê°€"]
    },
    "ë³´í†µì ˆì•½": {
        "name": "ğŸ’ª ë³´í†µ ì ˆì•½", 
        "description": "ì£¼ìš” ì§€ì¶œ ì¹´í…Œê³ ë¦¬ ì¤‘ì‹¬ ì ˆì•½",
        "reduction_rate": 0.2,  # 20% ì ˆì•½
        "includes_fixed_costs": False,
        "priority_categories": ["ë°°ë‹¬ìŒì‹", "ì¹´í˜/ê°„ì‹", "ì˜¨ë¼ì¸ì‡¼í•‘", "íƒì‹œ", "ì·¨ë¯¸/ì—¬ê°€"]
    },
    "ì•½í•œì ˆì•½": {
        "name": "ğŸŒ± ì•½í•œ ì ˆì•½",
        "description": "ë¹ˆë²ˆí•˜ê³  ë¶ˆí•„ìš”í•œ ì†Œë¹„ ì ì§„ì  ì ˆì•½",
        "reduction_rate": 0.1,  # 10% ì ˆì•½
        "includes_fixed_costs": False,
        "priority_categories": ["ì¹´í˜/ê°„ì‹", "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”", "ë°°ë‹¬ìŒì‹"]
    }
}

# ì¹´í…Œê³ ë¦¬ë³„ ì ˆì•½ ì „ëµ í…œí”Œë¦¿
SAVING_STRATEGIES = {
    # ê³ ì •ë¹„ ê´€ë ¨
    "êµ¬ë…ì„œë¹„ìŠ¤": {
        "ê°•í•œì ˆì•½": "ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” êµ¬ë… {unused_count}ê°œ í•´ì§€ + í”„ë¦¬ë¯¸ì—„ ìš”ê¸ˆì œ {downgrade_count}ê°œ ë‹¤ìš´ê·¸ë ˆì´ë“œë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” êµ¬ë… {unused_count}ê°œ í•´ì§€í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ê°€ì¥ ì‚¬ìš© ë¹ˆë„ê°€ ë‚®ì€ êµ¬ë… 1ê°œ í•´ì§€í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì£¼ê±°/í†µì‹ ": {
        "ê°•í•œì ˆì•½": "í†µì‹ ìš”ê¸ˆì œ ì¬ê²€í†  + ë¶ˆí•„ìš”í•œ ì˜µì…˜ í•´ì§€ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "í†µì‹ ìš”ê¸ˆì œ ë‹¤ìš´ê·¸ë ˆì´ë“œë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¶€ê°€ì„œë¹„ìŠ¤ í•´ì§€ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    
    # ë³€ë™ë¹„ ê´€ë ¨
    "ë°°ë‹¬ìŒì‹": {
        "ê°•í•œì ˆì•½": "ë°°ë‹¬ìŒì‹ì„ ì£¼ {current_count}íšŒì—ì„œ {target_count}íšŒë¡œ ì¤„ì´ê³  ì§ì ‘ ìš”ë¦¬ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ë°°ë‹¬ìŒì‹ ì£¼ë¬¸ì„ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ë°°ë‹¬ìŒì‹ ëŒ€ì‹  ê°„í¸ì‹ ì´ìš©ìœ¼ë¡œ ì£¼ 1íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì¹´í˜/ê°„ì‹": {
        "ê°•í•œì ˆì•½": "ì¹´í˜ ì´ìš©ì„ í•˜ë£¨ {current_count}íšŒì—ì„œ {target_count}íšŒë¡œ ì¤„ì´ê³  í™ˆì¹´í˜ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì¹´í˜ ë°©ë¬¸ì„ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ê°„ì‹ êµ¬ë§¤ë¥¼ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì˜¨ë¼ì¸ì‡¼í•‘": {
        "ê°•í•œì ˆì•½": "ì¶©ë™êµ¬ë§¤ ê¸ˆì§€ + í•„ìˆ˜í’ˆëª©ë§Œ êµ¬ë§¤ ë¦¬ìŠ¤íŠ¸ ì‘ì„±ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì˜¨ë¼ì¸ì‡¼í•‘ ë¹ˆë„ë¥¼ ì›” {current_count}íšŒì—ì„œ {target_count}íšŒë¡œ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ì¿ í° ì ê·¹ í™œìš© + í• ì¸ ì‹œê¸° êµ¬ë§¤ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "êµí†µ/ìë™ì°¨": {
        "ê°•í•œì ˆì•½": "íƒì‹œ ì´ìš©ì„ ëŒ€ì¤‘êµí†µìœ¼ë¡œ ì™„ì „ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "íƒì‹œ ì´ìš©ì„ ì£¼ {reduce_count}íšŒ ì¤„ì´ê³  ëŒ€ì¤‘êµí†µ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "ê°€ê¹Œìš´ ê±°ë¦¬ëŠ” ë„ë³´/ìì „ê±° ì´ìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "ì·¨ë¯¸/ì—¬ê°€": {
        "ê°•í•œì ˆì•½": "ìœ ë£Œ ì—¬ê°€í™œë™ì„ ë¬´ë£Œ/ì €ë ´í•œ ëŒ€ì•ˆìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "ì—¬ê°€ ì§€ì¶œì„ ì›” {budget:,}ì› ì˜ˆì‚°ìœ¼ë¡œ ì œí•œí•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "í• ì¸ í˜œíƒ ì ê·¹ í™œìš©ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    },
    "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”": {
        "ê°•í•œì ˆì•½": "í¸ì˜ì  ì´ìš©ì„ ë§ˆíŠ¸ ëŒ€ëŸ‰êµ¬ë§¤ë¡œ ëŒ€ì²´í•˜ì—¬ ì›” {amount:,}ì› ì ˆì•½",
        "ë³´í†µì ˆì•½": "í¸ì˜ì  ë°©ë¬¸ì„ ì£¼ {reduce_count}íšŒ ì¤„ì—¬ì„œ ì›” {amount:,}ì› ì ˆì•½",
        "ì•½í•œì ˆì•½": "í•„ìš”í•œ ê²ƒë§Œ êµ¬ë§¤ ë¦¬ìŠ¤íŠ¸ ì‘ì„±ìœ¼ë¡œ ì›” {amount:,}ì› ì ˆì•½"
    }
}

# ì ˆì•½ ê³„ì‚° ê¸°ì¤€
SAVING_CALCULATION_RULES = {
    "ê°•í•œì ˆì•½": {
        "min_target_reduction": 0.25,  # ìµœì†Œ 25% ì ˆì•½
        "max_target_reduction": 0.4,   # ìµœëŒ€ 40% ì ˆì•½
        "include_categories": ["ëª¨ë“ ì¹´í…Œê³ ë¦¬"],
        "strategy_focus": "êµ¬ì¡°ì  ë³€í™”"
    },
    "ë³´í†µì ˆì•½": {
        "min_target_reduction": 0.15,  # ìµœì†Œ 15% ì ˆì•½
        "max_target_reduction": 0.25,  # ìµœëŒ€ 25% ì ˆì•½
        "exclude_categories": ["ì£¼ê±°/í†µì‹ ", "ì˜ë£Œ/ê±´ê°•", "êµìœ¡"],
        "strategy_focus": "ìŠµê´€ ê°œì„ "
    },
    "ì•½í•œì ˆì•½": {
        "min_target_reduction": 0.05,  # ìµœì†Œ 5% ì ˆì•½
        "max_target_reduction": 0.15,  # ìµœëŒ€ 15% ì ˆì•½
        "exclude_categories": ["ì£¼ê±°/í†µì‹ ", "ì˜ë£Œ/ê±´ê°•", "êµìœ¡", "êµí†µ/ìë™ì°¨"],
        "strategy_focus": "ì ì§„ì  ë³€í™”"
    }
}

# OpenAI ëª¨ë¸ ì‹œìŠ¤í…œ ì§€ì‹œë¬¸
SYSTEM_INSTRUCTIONS = """
ë„ˆëŠ” ê°œì¸ì˜ ê²°ì œë‚´ì—­ì„ ë¶„ì„í•˜ì—¬ ì¢…í•©ì ì¸ ì†Œë¹„ íŒ¨í„´ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ê¸ˆìœµ ë¶„ì„ê°€ë‹¤.

[ë¶„ì„ ìš”êµ¬ì‚¬í•­]
1) ì „ì²´ ì§€ì¶œ ì§‘ê³„ ë° ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„
2) ì†Œë¹„ íŒ¨í„´ê³¼ íŠ¸ë Œë“œ ë¶„ì„ (ì‹œê°„ëŒ€, ìš”ì¼ë³„ íŠ¹ì„± ê³ ë ¤)
3) ìœ„í—˜ íŒ¨í„´ ë° ê³¼ì†Œë¹„ ì˜ì—­ ì‹ë³„
4) 3ë‹¨ê³„ ë ˆë²¨ë³„ ë§ì¶¤ ì ˆì•½ ì œì•ˆ

[ì¶œë ¥ í˜•ì‹(JSONë§Œ)]
{
  "total_spent": 0,
  "category_breakdown": {
    "ì¹´í…Œê³ ë¦¬ëª…": {"amount": 0, "ratio": 0.0, "transaction_count": 0, "avg_amount": 0}
  },
  "spending_trend": "ìƒìŠ¹|í•˜ë½|ì•ˆì •",
  "avg_transaction": 0,
  "top_expenses": [
    {"merchant": "ìƒì ëª…", "amount": 0, "category": "ì¹´í…Œê³ ë¦¬"}
  ],
  "spending_type": "ì†Œë¹„ íŒ¨í„´ ìš”ì•½ (ì˜ˆ: ì™¸ì‹Â·ë°°ë‹¬ ì¤‘ì‹¬, ì£¼ë§ ì§€ì¶œ ì§‘ì¤‘)",
  "risk_patterns": ["ìœ„í—˜ íŒ¨í„´ ëª©ë¡"],
  "overspending_categories": ["ê³¼ì†Œë¹„ ì¹´í…Œê³ ë¦¬ ëª©ë¡"],
  "saving_suggestions": {
    "ê°•í•œì ˆì•½": {
      "level": "ğŸ”¥ ê°•í•œ ì ˆì•½",
      "description": "ê³ ì •ë¹„ë¥¼ í¬í•¨í•œ ì „ë©´ì  ì§€ì¶œ ì ˆì•½",
      "expected_saving": 0,
      "reduction_rate": "25-40%",
      "strategies": [
        {
          "category": "ì¹´í…Œê³ ë¦¬ëª…",
          "current_amount": 0,
          "target_amount": 0,
          "saving_amount": 0,
          "method": "êµ¬ì²´ì ì¸ ì ˆì•½ ë°©ë²•",
          "difficulty": "ìƒ|ì¤‘|í•˜"
        }
      ]
    },
    "ë³´í†µì ˆì•½": {
      "level": "ğŸ’ª ë³´í†µ ì ˆì•½",
      "description": "ì£¼ìš” ì§€ì¶œ ì¹´í…Œê³ ë¦¬ ì¤‘ì‹¬ ì ˆì•½",
      "expected_saving": 0,
      "reduction_rate": "15-25%",
      "strategies": [
        {
          "category": "ì¹´í…Œê³ ë¦¬ëª…",
          "current_amount": 0,
          "target_amount": 0,
          "saving_amount": 0,
          "method": "êµ¬ì²´ì ì¸ ì ˆì•½ ë°©ë²•",
          "difficulty": "ìƒ|ì¤‘|í•˜"
        }
      ]
    },
    "ì•½í•œì ˆì•½": {
      "level": "ğŸŒ± ì•½í•œ ì ˆì•½",
      "description": "ë¹ˆë²ˆí•˜ê³  ë¶ˆí•„ìš”í•œ ì†Œë¹„ ì ì§„ì  ì ˆì•½",
      "expected_saving": 0,
      "reduction_rate": "5-15%",
      "strategies": [
        {
          "category": "ì¹´í…Œê³ ë¦¬ëª…",
          "current_amount": 0,
          "target_amount": 0,
          "saving_amount": 0,
          "method": "êµ¬ì²´ì ì¸ ì ˆì•½ ë°©ë²•",
          "difficulty": "ìƒ|ì¤‘|í•˜"
        }
      ]
    }
  }
}

[ì ˆì•½ ì œì•ˆ ê°€ì´ë“œë¼ì¸]
ê°•í•œì ˆì•½ (25-40% ì ˆì•½):
- ê³ ì •ë¹„(êµ¬ë…ì„œë¹„ìŠ¤, í†µì‹ ë¹„) í¬í•¨ ì „ë©´ì  ì ˆì•½
- êµ¬ì¡°ì  ë³€í™” ìš”êµ¬ (ìš”ê¸ˆì œ ë³€ê²½, êµ¬ë… í•´ì§€ ë“±)
- ë†’ì€ ì ˆì•½ íš¨ê³¼, ë†’ì€ ì‹¤í–‰ ë‚œì´ë„

ë³´í†µì ˆì•½ (15-25% ì ˆì•½):
- ì£¼ìš” ë³€ë™ë¹„ ì¹´í…Œê³ ë¦¬ ì¤‘ì‹¬ ì ˆì•½
- ìŠµê´€ ê°œì„  ì¤‘ì‹¬ (ë¹ˆë„ ì¤„ì´ê¸°, ëŒ€ì•ˆ ì°¾ê¸° ë“±)
- ì¤‘ê°„ ì ˆì•½ íš¨ê³¼, ì¤‘ê°„ ì‹¤í–‰ ë‚œì´ë„

ì•½í•œì ˆì•½ (5-15% ì ˆì•½):
- ë¹ˆë²ˆí•˜ê³  ì†Œì•¡ì¸ ë¶ˆí•„ìš” ì†Œë¹„ ì¤‘ì‹¬
- ì ì§„ì  ë³€í™” (í• ì¸ í™œìš©, ì¼ë¶€ ì¤„ì´ê¸° ë“±)
- ë‚®ì€ ì ˆì•½ íš¨ê³¼, ë‚®ì€ ì‹¤í–‰ ë‚œì´ë„

[ë¶„ì„ ê¸°ì¤€]
- category_breakdown: 'keyword_hints'ì™€ 'amount_hints'ë¥¼ ì¢…í•©í•˜ì—¬ ì£¼ìš” ì¹´í…Œê³ ë¦¬ë³„ ê¸ˆì•¡ê³¼ ë¹„ìœ¨ ê³„ì‚°
- spending_type: 'weekday_type', 'time_bucket' ì •ë³´ë¥¼ í™œìš©í•œ ì†Œë¹„ íŠ¹ì„± ìš”ì•½
- risk_patterns: ìƒˆë²½ ì‹œê°„ëŒ€ ì†Œë¹„, ê³ ì•¡ ê²°ì œ, ë°˜ë³µì  ì†Œë¹„ íŒ¨í„´ ë“± ì‹ë³„
- overspending_categories: í‰ê·  ëŒ€ë¹„ ê³¼ë„í•œ ì§€ì¶œ ì¹´í…Œê³ ë¦¬
- saving_suggestions: ê° ë ˆë²¨ë³„ë¡œ ì‹¤ì œ ê¸ˆì•¡ê³¼ êµ¬ì²´ì ì¸ ë°©ë²•ì„ í¬í•¨í•œ ë§ì¶¤ ì ˆì•½ ì „ëµ

[ì£¼ì˜ì‚¬í•­]
- ë°˜ë“œì‹œ ìœ íš¨í•œ JSONë§Œ ì¶œë ¥
- ê¸ˆì•¡ì€ ì •ìˆ˜ë¡œ ë°˜ì˜¬ë¦¼
- ë¹„ìœ¨ì€ ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€
- ê° ì ˆì•½ ë ˆë²¨ë³„ë¡œ í˜„ì‹¤ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì•ˆ ì‘ì„±
- ì ˆì•½ ê¸ˆì•¡ ê³„ì‚° ì‹œ í˜„ì¬ ì§€ì¶œ íŒ¨í„´ê³¼ ë¹ˆë„ë¥¼ ê³ ë ¤
- ë°ì´í„°ê°€ ë¶€ì¡±í•œ ê²½ìš° ë³´ìˆ˜ì ìœ¼ë¡œ ë¶„ì„
"""

# ì ˆì•½ ì œì•ˆ ê³„ì‚° í—¬í¼ í•¨ìˆ˜ë“¤
def calculate_saving_amount(category, current_amount, level, transaction_count=1):
    """
    ì¹´í…Œê³ ë¦¬ë³„ ì ˆì•½ ê¸ˆì•¡ ê³„ì‚°
    """
    rules = SAVING_CALCULATION_RULES[level]
    
    # ê¸°ë³¸ ì ˆì•½ë¥  ì ìš©
    base_reduction = rules["min_target_reduction"]
    max_reduction = rules["max_target_reduction"]
    
    # ì¹´í…Œê³ ë¦¬ë³„ ê°€ì¤‘ì¹˜ ì ìš©
    if category in ["êµ¬ë…ì„œë¹„ìŠ¤", "ì£¼ê±°/í†µì‹ "] and level == "ê°•í•œì ˆì•½":
        reduction_rate = max_reduction  # ê³ ì •ë¹„ëŠ” ê°•í•œì ˆì•½ì—ì„œ ìµœëŒ€ ì ˆì•½
    elif category in ["ë°°ë‹¬ìŒì‹", "ì¹´í˜/ê°„ì‹"] and transaction_count > 10:
        reduction_rate = (base_reduction + max_reduction) / 2  # ë¹ˆë²ˆí•œ ì†Œë¹„ëŠ” ì¤‘ê°„ ì ˆì•½ë¥ 
    else:
        reduction_rate = base_reduction
    
    return int(current_amount * reduction_rate)

def get_difficulty_level(category, level, current_amount):
    """
    ì ˆì•½ ë‚œì´ë„ ê³„ì‚°
    """
    # ê³ ì •ë¹„ëŠ” êµ¬ì¡°ì  ë³€ê²½ì´ í•„ìš”í•˜ë¯€ë¡œ ë‚œì´ë„ ë†’ìŒ
    if category in ["êµ¬ë…ì„œë¹„ìŠ¤", "ì£¼ê±°/í†µì‹ "]:
        if level == "ê°•í•œì ˆì•½":
            return "ìƒ"
        else:
            return "ì¤‘"
    
    # ë†’ì€ ê¸ˆì•¡ ì¹´í…Œê³ ë¦¬ëŠ” ì ˆì•½ ë‚œì´ë„ ë†’ìŒ
    if current_amount > 100000:
        return "ìƒ" if level == "ê°•í•œì ˆì•½" else "ì¤‘"
    
    # ì¼ë°˜ì ì¸ ê²½ìš°
    difficulty_map = {
        "ê°•í•œì ˆì•½": "ì¤‘",
        "ë³´í†µì ˆì•½": "ì¤‘", 
        "ì•½í•œì ˆì•½": "í•˜"
    }
    return difficulty_map[level]

def generate_saving_method(category, level, current_amount, transaction_count):
    """
    ì¹´í…Œê³ ë¦¬ì™€ ë ˆë²¨ì— ë§ëŠ” ì ˆì•½ ë°©ë²• ìƒì„±
    """
    if category not in SAVING_STRATEGIES:
        return f"{level} ìˆ˜ì¤€ì—ì„œ {category} ì§€ì¶œì„ ì¤„ì—¬ ì ˆì•½í•˜ì„¸ìš”"
    
    strategy_template = SAVING_STRATEGIES[category][level]
    
    # í…œí”Œë¦¿ì— í•„ìš”í•œ ê°’ë“¤ ê³„ì‚°
    values = {}
    
    # ì ˆì•½ ê¸ˆì•¡ ê³„ì‚°
    saving_amount = calculate_saving_amount(category, current_amount, level, transaction_count)
    values["amount"] = saving_amount
    
    if "{current_count}" in strategy_template:
        values["current_count"] = max(1, transaction_count // 4)  # ì£¼ê°„ í‰ê· 
    
    if "{target_count}" in strategy_template:
        reduction_rate = SAVING_CALCULATION_RULES[level]["min_target_reduction"]
        values["target_count"] = max(1, int(values.get("current_count", 1) * (1 - reduction_rate)))
    
    if "{reduce_count}" in strategy_template:
        values["reduce_count"] = max(1, values.get("current_count", 1) - values.get("target_count", 1))
    
    if "{unused_count}" in strategy_template:
        values["unused_count"] = min(3, max(1, transaction_count // 10))
    
    if "{downgrade_count}" in strategy_template:
        values["downgrade_count"] = min(2, max(1, transaction_count // 15))
    
    if "{budget}" in strategy_template:
        values["budget"] = int(current_amount * 0.7)  # 30% ì˜ˆì‚° ê°ì¶•
    
    try:
        return strategy_template.format(**values)
    except KeyError as e:
        # ëˆ„ë½ëœ í‚¤ê°€ ìˆëŠ” ê²½ìš° ê¸°ë³¸ ë©”ì‹œì§€ ë°˜í™˜
        return f"{category}ì—ì„œ ì›” {saving_amount:,}ì› ì ˆì•½ ê°€ëŠ¥"

# ì¹´í…Œê³ ë¦¬ë³„ ìš°ì„ ìˆœìœ„ ì ìˆ˜ (ë†’ì„ìˆ˜ë¡ ì ˆì•½ íš¨ê³¼ í¼)
CATEGORY_PRIORITY_SCORES = {
    "ë°°ë‹¬ìŒì‹": 9,
    "ì˜¨ë¼ì¸ì‡¼í•‘": 8,
    "ì¹´í˜/ê°„ì‹": 7,
    "ì·¨ë¯¸/ì—¬ê°€": 7,
    "êµ¬ë…ì„œë¹„ìŠ¤": 6,
    "í¸ì˜ì /ë§ˆíŠ¸/ì¡í™”": 5,
    "êµí†µ/ìë™ì°¨": 4,
    "ì£¼ê±°/í†µì‹ ": 3,
    "ì˜ë£Œ/ê±´ê°•": 2,
    "êµìœ¡": 1
}
